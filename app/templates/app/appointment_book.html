{% extends "base.html" %}
{% load django_bootstrap5 %}

{% block content %}
<h2>Book Appointment</h2>
    <form method="post">
        {% csrf_token %}
        {% bootstrap_form form %}
        {% bootstrap_button button_type="submit" content="Create Appointment" %}
    </form>

    <h2>My Appointments</h2>

    {% if appointments %}
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Date</th>
                <th>Practitioner</th>
                <th>Time</th>
                <th>Duration (mins)</th>
                <th>Price</th>
                <th>Description</th>
                <th>Payment</th>
                <th>Cancel appointment</th>
            </tr>
        </thead>
        <tbody>
            {% for appointment in appointments %}
            <tr>
                <td>{{ appointment.date }} </td>
                <td>{{ appointment.practitioner.username }} </td>
                <td>{{ appointment.time }} </td>
                <td>{{ appointment.duration }} </td>
                <td>{{ appointment.price }} </td>
                <td>{{ appointment.description }}</td>
                <td>
                    {% if not appointment.isPaid %}
                    <form action="{% url 'payment' appointment.id %}" method="get">
                        {% csrf_token %}
                        {% bootstrap_button button_type="submit" content="Pay" %}
                    </form>
                    {% else %}
                    Paid
                    <form method="post" action="{% url 'invoice_download' %}">
                        {% csrf_token %}
                        <input type="hidden" name="appointmentid" value="{{ appointment.id }}">
                        {% bootstrap_button button_type="submit" content="Print invoice" %}
                    </form>
                    {% endif %}
                </td>
                <td>
                    <form action="{% url 'cancel_appointment' appointment.id %}" method="post">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger">Cancel</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>No appointments found.</p>
    {% endif %}
{% endblock %}
